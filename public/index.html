<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Machine learning example</title>
<script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script type="text/javascript">
  angular.module('app', [])
  .run(($http) => {
    google.charts.load('current', {'packages':['corechart','scatter']});
    let rawDataChart, indoorData, outdoorData;
    const chartPromise = new Promise((resolve, reject) => {
      function chartLoaded() {
        rawDataChart = new google.visualization.ScatterChart(document.getElementById('raw-data-chart-div'));
        resolve();
      };
      google.charts.setOnLoadCallback(chartLoaded);
    }).then(() => {
      return $http.get('/train/indoor.json');
    }).then((indoorDataResponse) => {
      indoorData = indoorDataResponse;
      return $http.get('/train/outdoor.json');
    }).then((outdoorDataResponse) => {
      outdoorData = outdoorDataResponse;
    }).then(() => {
      
      // Google Charts have this weird way of handling multiple sets, by setting the other value as null.
      const dataRows = outdoorData.data.map((item) => {
        return {c: [{v: new Number(item.t)}, {v: new Number(item.h)}, null]};
      }).concat(indoorData.data.map((item) => {
        return {c: [{v: new Number(item.t)}, null, {v: new Number(item.h)}]};
      }));
      const data = new google.visualization.DataTable({
        cols: [{id: 'temperature', label: 'Temperature', type: 'number'},
               {id: 'humidity-out', label: 'outdoors', type: 'number'},
               {id: 'humidity-in', label: 'indoors', type: 'number'}
               ],
        rows: dataRows
      });
      const bothDataRows = outdoorData.data.concat(indoorData.data).map((item) => [new Number(item.t), new Number(item.h)]);
      // ... is the ES6 spread operator
      const minT = Math.min(...bothDataRows.map((item) => item[0]));
      const maxT = Math.max(...bothDataRows.map((item) => item[0]));
      const minH = Math.min(...bothDataRows.map((item) => item[1]));
      const maxH = Math.max(...bothDataRows.map((item) => item[1]));

      const options = {
        title: 'Temperature vs Humidity',
        hAxis: {title: 'Temperature', minValue: minT, maxValue: maxT},
        vAxis: {title: 'Humidity', minValue: minH, maxValue: maxH},
        // legend: 'none',
        colors: ["#101090","#109010"],
        pointSize: 2
      };
      // convertOptions is for using the new Material Charts.
      rawDataChart.draw(data, google.charts.Scatter.convertOptions(options));
    }).then(() => {
      
    });
  });
</script>
</head>

<body ng-app="app">
  <p>
    Machine learning example.
    Source of the example data: <a href="https://archive.ics.uci.edu/ml/datasets/SML2010">SML2010</a>
  </p>
  <h1>Humidity against Temperature Indoors and Outdoors</h1>
  <div id="raw-data-chart-div" style="width: 800px; height: 500px;">
  </div>
</body>

</html> 
